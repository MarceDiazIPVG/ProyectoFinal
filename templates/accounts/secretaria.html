{% extends "base.html" %}
{% load static %}

{% block title %}Panel Secretar√≠a{% endblock %}

{% block content %}
<style>
  .sec-wrapper {
    max-width: 1100px;
    margin: 24px auto 40px auto;
  }
  .sec-header {
    background:#ffffff;
    border-radius:12px;
    padding:16px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 6px rgba(15,23,42,.35);
    margin-bottom:16px;
  }
  .sec-header-info h1 {
    margin:0;
    font-size:1.4rem;
    color:#111827;
  }
  .sec-header-info p {
    margin:2px 0 0 0;
    font-size:.9rem;
    color:#6b7280;
  }
  .sec-user-badge {
    display:flex;
    align-items:center;
    gap:8px;
  }
  .sec-avatar {
    width:36px;
    height:36px;
    border-radius:999px;
    background:#e5e7eb;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    color:#4b5563;
  }
  .sec-tabs {
    margin-top:14px;
    background:#111827;
    border-radius:12px;
    padding:4px;
    display:flex;
    gap:4px;
  }
  .sec-tab-btn {
    flex:1;
    padding:8px 10px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:500;
    font-size:.95rem;
    background:transparent;
    color:#e5e7eb;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:6px;
  }
  .sec-tab-btn.active {
    background:#4f46e5;
    color:#f9fafb;
  }
  .sec-body {
    margin-top:18px;
    display:grid;
    gap:18px;
  }
  .sec-card {
    background:#111827;
    border-radius:12px;
    padding:16px;
    border:1px solid #1f2937;
  }
  .sec-card h2 {
    margin:0 0 12px 0;
    font-size:1.1rem;
    color:#a78bfa;
    display:flex;
    align-items:center;
    gap:6px;
  }
  .sec-badges {
    display:flex;
    gap:12px;
    margin-top:8px;
    font-size:.9rem;
  }
  .sec-badge {
    padding:4px 8px;
    border-radius:999px;
    background:#0f172a;
    color:#e5e7eb;
  }
  .sec-list {
    margin-top:10px;
    display:grid;
    gap:10px;
  }
  .sec-item {
    border-radius:10px;
    border:1px solid #1f2937;
    padding:10px 12px;
    background:#020617;
  }
  .sec-item-header {
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
  }
  .sec-item-title {
    font-weight:600;
    color:#e5e7eb;
  }
  .sec-item-meta {
    font-size:.85rem;
    color:#9ca3af;
    margin-top:4px;
  }
  .sec-item-body {
    margin-top:6px;
    font-size:.9rem;
    color:#cbd5f5;
  }
  .sec-item-actions {
    display:flex;
    gap:6px;
    margin-left:auto;
  }
  .sec-btn-sm {
    border:none;
    border-radius:8px;
    padding:4px 8px;
    font-size:.8rem;
    cursor:pointer;
  }
  .sec-btn-sm.danger {
    background:#fee2e2;
    color:#b91c1c;
  }
  .sec-btn-sm.primary {
    background:#22c55e;
    color:#022c22;
  }
  .sec-section-title-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
  }
  .sec-btn-main {
    border:none;
    border-radius:8px;
    padding:6px 12px;
    font-size:.9rem;
    cursor:pointer;
    background:#4f46e5;
    color:#f9fafb;
  }
  .sec-form {
    margin-top:12px;
    border-radius:10px;
    border:1px dashed #374151;
    padding:10px 12px;
    background:#020617;
  }
  .sec-form-row {
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .sec-form-group {
    flex:1;
    min-width:140px;
    margin-bottom:8px;
  }
  .sec-form-group label {
    display:block;
    font-size:.8rem;
    color:#9ca3af;
    margin-bottom:2px;
  }
  .sec-form-group input,
  .sec-form-group textarea,
  .sec-form-group select {
    width:100%;
    border-radius:8px;
    border:1px solid #4b5563;
    background:#020617;
    color:#e5e7eb;
    padding:6px 8px;
    font-size:.85rem;
  }
  .sec-form-group textarea {
    resize:vertical;
    min-height:50px;
  }
  .sec-form-actions {
    display:flex;
    justify-content:flex-end;
    gap:8px;
    margin-top:8px;
  }
  .sec-btn-secondary {
    border-radius:8px;
    border:1px solid #4b5563;
    background:transparent;
    color:#e5e7eb;
    padding:6px 12px;
    font-size:.85rem;
    cursor:pointer;
  }
  .sec-btn-primary {
    border-radius:8px;
    border:none;
    background:#4f46e5;
    color:#f9fafb;
    padding:6px 12px;
    font-size:.85rem;
    cursor:pointer;
  }
  .muted {
    color:#9ca3af;
    font-size:.9rem;
  }
</style>

<div class="sec-wrapper">

  <!-- CABECERA -->
  <div class="sec-header">
    <div class="sec-header-info">
      <h1>Panel de Secretar√≠a</h1>
      <p>Gesti√≥n administrativa del campeonato ANFA</p>
      <div class="sec-badges">
        <span class="sec-badge">Anuncios: {{ total_anuncios }}</span>
        <span class="sec-badge">Documentos: {{ total_docs }}</span>
      </div>
    </div>
    <div class="sec-user-badge">
      <div class="sec-avatar">
        {{ user_nombre|first|upper }}
      </div>
      <div>
        <div style="font-size:.95rem;color:#111827;font-weight:600;">{{ user_nombre }}</div>
        <div style="font-size:.8rem;color:#6b7280;">Secretar√≠a</div>
      </div>
    </div>
  </div>

  <!-- TABS (se controlan por ?tab=...) -->
  <div class="sec-tabs">
    <a href="?tab=reuniones" style="flex:1;text-decoration:none;">
      <button type="button"
              class="sec-tab-btn {% if active_tab == 'reuniones' %}active{% endif %}">
        üìÖ <span>Reuniones</span>
      </button>
    </a>
    <a href="?tab=notificaciones" style="flex:1;text-decoration:none;">
      <button type="button"
              class="sec-tab-btn {% if active_tab == 'notificaciones' %}active{% endif %}">
        üîî <span>Notificaciones</span>
      </button>
    </a>
    <a href="?tab=documentos" style="flex:1;text-decoration:none;">
      <button type="button"
              class="sec-tab-btn {% if active_tab == 'documentos' %}active{% endif %}">
        üìÑ <span>Documentos</span>
      </button>
    </a>
  </div>

  <div class="sec-body">

    {# ====================== REUNIONES ====================== #}
    {% if active_tab == "reuniones" %}
      <section class="sec-card">
        <div class="sec-section-title-row">
          <h2>üìÖ Agenda oficial & reuniones</h2>
        </div>

        <!-- Formulario crear reuni√≥n -->
        <form method="post" class="sec-form">
          {% csrf_token %}
          <input type="hidden" name="accion" value="crear_reunion">
          <input type="hidden" name="tab" value="reuniones">
          <div class="sec-form-row">
            <div class="sec-form-group">
              <label>T√≠tulo</label>
              <input type="text" name="titulo" placeholder="Reuni√≥n de directorio" required>
            </div>
            <div class="sec-form-group">
              <label>Fecha</label>
              <input type="date" name="fecha" required>
            </div>
            <div class="sec-form-group">
              <label>Hora</label>
              <input type="time" name="hora" required>
            </div>
            <div class="sec-form-group">
              <label>Lugar</label>
              <input type="text" name="lugar" placeholder="Sala de reuniones" required>
            </div>
          </div>
          <div class="sec-form-group">
            <label>Detalle / acuerdos</label>
            <textarea name="detalle" placeholder="Puntos a tratar, acuerdos esperados, etc."></textarea>
          </div>
          <div class="sec-form-actions">
            <button type="submit" class="sec-btn-primary">Crear reuni√≥n</button>
          </div>
        </form>

        <!-- Listado de reuniones -->
        {% if reuniones %}
          <div class="sec-list">
            {% for r in reuniones %}
              <div class="sec-item">
                <div class="sec-item-header">
                  <div>
                    <div class="sec-item-title">{{ r.titulo }}</div>
                    <div class="sec-item-meta">
                      üìÖ {{ r.fecha_evento }} ‚Äî üïí {{ r.hora|default:"--:--" }} ‚Äî üìç {{ r.lugar|default:"Sin lugar" }}
                    </div>
                  </div>
                  <div class="sec-item-actions">
                    <form method="post" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="accion" value="eliminar_reunion">
                      <input type="hidden" name="tab" value="reuniones">
                      <input type="hidden" name="id_anuncio" value="{{ r.id }}">
                      <button type="submit" class="sec-btn-sm danger">Eliminar</button>
                    </form>
                  </div>
                </div>
                {% if r.detalle %}
                  <div class="sec-item-body">
                    {{ r.detalle }}
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="muted" style="margin-top:10px;">No hay reuniones registradas a√∫n.</p>
        {% endif %}
      </section>
    {% endif %}

    {# ====================== NOTIFICACIONES ====================== #}
    {% if active_tab == "notificaciones" %}
      <section class="sec-card">
        <div class="sec-section-title-row">
          <h2>üîî Notificaciones internas</h2>
        </div>

        <!-- Formulario crear notificaci√≥n -->
        <form method="post" class="sec-form">
          {% csrf_token %}
          <input type="hidden" name="accion" value="crear_notificacion">
          <input type="hidden" name="tab" value="notificaciones">
          <div class="sec-form-group">
            <label>T√≠tulo</label>
            <input type="text" name="titulo" required placeholder="Recordatorio reuni√≥n, citaci√≥n, etc.">
          </div>
          <div class="sec-form-group">
            <label>Mensaje</label>
            <textarea name="mensaje" required placeholder="Contenido de la notificaci√≥n..."></textarea>
          </div>
          <div class="sec-form-actions">
            <button type="submit" class="sec-btn-primary">Guardar notificaci√≥n</button>
          </div>
        </form>

        <!-- Listado -->
        {% if notificaciones %}
          <div class="sec-list">
            {% for n in notificaciones %}
              <div class="sec-item">
                <div class="sec-item-header">
                  <div>
                    <div class="sec-item-title">
                      {{ n.titulo }}
                      {% if n.enviado %}
                        <span style="font-size:.75rem;background:#bbf7d0;color:#166534;border-radius:999px;padding:2px 8px;margin-left:4px;">
                          Enviado
                        </span>
                      {% else %}
                        <span style="font-size:.75rem;background:#fef9c3;color:#92400e;border-radius:999px;padding:2px 8px;margin-left:4px;">
                          Pendiente
                        </span>
                      {% endif %}
                    </div>
                    <div class="sec-item-meta">
                      üìÖ {{ n.fecha }}
                    </div>
                  </div>
                  <div class="sec-item-actions">
                    {% if not n.enviado %}
                      <form method="post" style="margin:0;">
                        {% csrf_token %}
                        <input type="hidden" name="accion" value="enviar_notificacion">
                        <input type="hidden" name="tab" value="notificaciones">
                        <input type="hidden" name="id_anuncio" value="{{ n.id }}">
                        <button type="submit" class="sec-btn-sm primary">Marcar enviada</button>
                      </form>
                    {% endif %}
                    <form method="post" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="accion" value="eliminar_notificacion">
                      <input type="hidden" name="tab" value="notificaciones">
                      <input type="hidden" name="id_anuncio" value="{{ n.id }}">
                      <button type="submit" class="sec-btn-sm danger">Eliminar</button>
                    </form>
                  </div>
                </div>
                <div class="sec-item-body">
                  {{ n.mensaje }}
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="muted" style="margin-top:10px;">No hay notificaciones registradas.</p>
        {% endif %}
      </section>
    {% endif %}

    {# ====================== DOCUMENTOS ====================== #}
    {% if active_tab == "documentos" %}
      <section class="sec-card">
        <div class="sec-section-title-row">
          <h2>üìÑ Gesti√≥n documental</h2>
        </div>

        <!-- Formulario registrar documento -->
        <form method="post" class="sec-form">
          {% csrf_token %}
          <input type="hidden" name="accion" value="crear_documento">
          <input type="hidden" name="tab" value="documentos">
          <div class="sec-form-row">
            <div class="sec-form-group">
              <label>Nombre del documento</label>
              <input type="text" name="nombre" required placeholder="Ej: Acta reuni√≥n 10-11-2025">
            </div>
            <div class="sec-form-group">
              <label>Tipo de documento</label>
              <input type="text" name="tipo_documento" placeholder="Acta, Oficio, Recibo, etc.">
            </div>
            <div class="sec-form-group">
              <label>Club asociado (opcional)</label>
              <select name="id_club">
                <option value="">-- Sin club --</option>
                {% for c in clubs %}
                  <option value="{{ c.id }}">{{ c.nombre }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="sec-form-group">
            <label>Referencia / ruta / glosa</label>
            <input type="text" name="archivo" placeholder="Ruta del archivo, URL o detalle interno.">
          </div>
          <div class="sec-form-actions">
            <button type="submit" class="sec-btn-primary">Registrar documento</button>
          </div>
        </form>

        <!-- Listado de documentos -->
        {% if documentos %}
          <div class="sec-list">
            {% for d in documentos %}
              <div class="sec-item">
                <div class="sec-item-header">
                  <div>
                    <div class="sec-item-title">{{ d.nombre }}</div>
                    <div class="sec-item-meta">
                      Tipo: {{ d.tipo }}{% if d.club %} ‚Äî Club: {{ d.club }}{% endif %} ‚Äî Subido: {{ d.fecha }}
                    </div>
                  </div>
                  <div class="sec-item-actions">
                    <form method="post" style="margin:0;">
                      {% csrf_token %}
                      <input type="hidden" name="accion" value="eliminar_documento">
                      <input type="hidden" name="tab" value="documentos">
                      <input type="hidden" name="id_documento" value="{{ d.id }}">
                      <button type="submit" class="sec-btn-sm danger">Eliminar</button>
                    </form>
                  </div>
                </div>
                {% if d.archivo %}
                  <div class="sec-item-body">
                    Ref: {{ d.archivo }}
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="muted" style="margin-top:10px;">No hay documentos registrados.</p>
        {% endif %}
      </section>
    {% endif %}

  </div>
</div>
{% endblock %}
