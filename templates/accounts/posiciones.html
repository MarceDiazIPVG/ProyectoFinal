{% extends 'base.html' %}
{% block title %}Tabla de Posiciones{% endblock %}
{% block content %}
<style>
  .wrap { max-width: 1100px; margin: 32px auto; padding: 0 16px; }
  h2 { color:#a78bfa; margin-bottom: 8px; text-align:center; }
  p.sub { color:#94a3b8; text-align:center; margin:4px 0 16px; }

  .card { background:#1f2937; border-radius:12px; padding:16px; box-shadow:0 2px 10px rgba(0,0,0,.3); margin-bottom:16px; }
  .btn{ background:#a78bfa; color:#111827; border:none; padding:9px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
  .btn:hover{ background:#8b5cf6; color:#fff; }
  .btn-ghost{ background:#111827; border:1px solid #a78bfa; color:#a78bfa; }
  .btn-ghost:hover{ background:#0c1220; border-color:#8b5cf6; color:#fff; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { padding:10px 12px; border-bottom:1px solid #374151; text-align:left; vertical-align:middle; }
  th { color:#a78bfa; }
  .msg { text-align:center; margin:8px 0; }
  .msg.ok  { color:#34d399; }
  .msg.err { color:#f87171; }
</style>

<div class="wrap">
  <h2>Tabla de Posiciones</h2>
  <p class="sub">Consulta la clasificación y recalcula la tabla por torneo.</p>

  {% if messages %}
    {% for message in messages %}
      <div class="msg {% if message.tags == 'success' %}ok{% else %}err{% endif %}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div class="card">
    <form method="get" style="display:flex; gap:8px; flex-wrap:wrap;">
      <input type="number" name="id_torneo" min="1" placeholder="ID Torneo" value="{{ id_torneo|default:'' }}" style="height:38px; background:#111827; border:1px solid #374151; border-radius:8px; color:#f3f4f6; padding:0 10px;">
      <button class="btn" type="submit">Cargar posiciones</button>
      <a class="btn-ghost" href="{% url 'posiciones_torneo' %}">Limpiar</a>
    </form>

    <form method="post" action="{% url 'recalc_posiciones' %}" style="display:flex; gap:8px; align-items:center; margin-top:10px;">
      {% csrf_token %}
      <input type="number" name="id_torneo" min="1" placeholder="ID Torneo" value="{{ id_torneo|default:'' }}" required style="height:38px; background:#111827; border:1px solid #374151; border-radius:8px; color:#f3f4f6; padding:0 10px; width:160px;">
      <button class="btn" type="submit">Recalcular posiciones</button>
    </form>
  </div>

  <div class="card">
    {% if posiciones and posiciones|length > 0 %}
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Club</th>
            <th>PJ</th>
            <th>G</th>
            <th>E</th>
            <th>P</th>
            <th>GF</th>
            <th>GC</th>
            <th>Puntos</th>
          </tr>
        </thead>
        <tbody>
          {% for r in posiciones %}
            {# r = (puntos, pj, pg, pe, pp, gf, gc, id_club, nombre) #}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ r.8 }}</td>
              <td>{{ r.1 }}</td>
              <td>{{ r.2 }}</td>
              <td>{{ r.3 }}</td>
              <td>{{ r.4 }}</td>
              <td>{{ r.5 }}</td>
              <td>{{ r.6 }}</td>
              <td><b>{{ r.0 }}</b></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="sub">No hay posiciones para el torneo seleccionado.</p>
    {% endif %}
  </div>

  <div style="text-align:center; margin-top:10px;">
    <a href="{% url 'dashboard' %}" class="btn-ghost">← Volver al Panel</a>
  </div>
</div>
{% endblock %}
